# TidyFlow - 开放问题 (Open Questions)

> 版本: 1.0 (Frozen)
> 最后更新: 2026-01-31

## 开放问题列表

以下问题尚未最终决定，但**不阻塞 M0 开发**。每个问题都有建议的默认选择，可以在后续里程碑中调整。

---

### Q1: WebView 与 Native 的通信方式

| 项目 | 内容 |
|------|------|
| **问题** | Swift 层如何与 WebView 中的 JavaScript 通信？ |
| **影响面** | M0 架构、性能、调试体验 |
| **选项** | <ol><li>**WKScriptMessageHandler** - Native 调用 JS 用 evaluateJavaScript，JS 调用 Native 用 postMessage</li><li>**WebSocket 直连** - WebView 直接连接 Rust Core，Swift 层不参与</li><li>**混合方案** - 控制命令走 Native Bridge，数据流走 WebSocket</li></ol> |
| **建议默认** | **选项 2: WebSocket 直连** - 简化架构，Swift 层只负责 UI 壳 |
| **何时决策** | M0 开始前必须确定 |
| **备注** | 需要验证 WKWebView 是否允许连接 localhost WebSocket |

---

### Q2: Rust Core 启动方式

| 项目 | 内容 |
|------|------|
| **问题** | Rust Core 二进制如何打包和启动？ |
| **影响面** | 应用打包、启动速度、更新机制 |
| **选项** | <ol><li>**嵌入 App Bundle** - 放在 Contents/MacOS/ 或 Contents/Resources/</li><li>**独立安装** - 用户单独安装，App 通过 PATH 查找</li><li>**动态下载** - 首次启动时下载</li></ol> |
| **建议默认** | **选项 1: 嵌入 App Bundle** - 用户体验最好，无需额外安装 |
| **何时决策** | M0 打包阶段 |
| **备注** | 需要考虑代码签名和公证 |

---

### Q3: 终端 Scrollback 持久化

| 项目 | 内容 |
|------|------|
| **问题** | 是否需要持久化终端 scrollback？如何实现？ |
| **影响面** | 用户体验、存储空间、性能 |
| **选项** | <ol><li>**不持久化** - 关闭终端后 scrollback 丢失</li><li>**按需持久化** - 用户手动保存</li><li>**自动持久化** - 定期保存到文件</li></ol> |
| **建议默认** | **选项 1: 不持久化** - M0-M1 简化实现，M2 可考虑添加 |
| **何时决策** | M1 完成后评估 |
| **备注** | 可以使用 xterm.js serialize addon |

---

### Q4: 多窗口 vs 单窗口多 Tab

| 项目 | 内容 |
|------|------|
| **问题** | 应用是支持多窗口还是单窗口多 Tab？ |
| **影响面** | UI 架构、窗口管理、用户体验 |
| **选项** | <ol><li>**单窗口多 Tab** - 类似 VS Code</li><li>**多窗口** - 类似 iTerm2</li><li>**混合** - 默认单窗口，支持拆分为多窗口</li></ol> |
| **建议默认** | **选项 1: 单窗口多 Tab** - M0-M1 简化实现 |
| **何时决策** | M1 UI 设计阶段 |
| **备注** | M2 可以扩展支持多窗口 |

---

### Q5: 主题/外观定制

| 项目 | 内容 |
|------|------|
| **问题** | 是否支持终端主题定制？如何实现？ |
| **影响面** | 用户体验、配置复杂度 |
| **选项** | <ol><li>**固定主题** - 只提供 light/dark 两种</li><li>**预设主题** - 提供多个预设主题选择</li><li>**完全自定义** - 用户可以自定义所有颜色</li></ol> |
| **建议默认** | **选项 1: 固定主题** - M0-M1 只支持跟随系统 light/dark |
| **何时决策** | M2 功能规划阶段 |
| **备注** | 可以参考 iTerm2 的主题格式 |

---

### Q6: Setup Script 执行环境

| 项目 | 内容 |
|------|------|
| **问题** | Setup script 在什么环境中执行？是否需要隔离？ |
| **影响面** | 安全性、可重复性、调试 |
| **选项** | <ol><li>**直接执行** - 继承用户环境</li><li>**清洁环境** - 最小化环境变量</li><li>**容器化** - 在 Docker 中执行</li></ol> |
| **建议默认** | **选项 1: 直接执行** - 最简单，符合用户预期 |
| **何时决策** | M1 setup 实现阶段 |
| **备注** | 可以通过配置选择是否继承环境 |

---

### Q7: 远程仓库认证

| 项目 | 内容 |
|------|------|
| **问题** | 如何处理需要认证的远程仓库？ |
| **影响面** | 用户体验、安全性 |
| **选项** | <ol><li>**依赖系统 credential helper** - 使用 git 配置的 credential helper</li><li>**内置 credential 管理** - 应用内管理 token</li><li>**Keychain 集成** - 使用 macOS Keychain</li></ol> |
| **建议默认** | **选项 1: 依赖系统 credential helper** - 最简单，用户已有配置 |
| **何时决策** | M2 远程克隆实现阶段 |
| **备注** | 可以提示用户配置 credential helper |

---

### Q8: 文件变更监听策略

| 项目 | 内容 |
|------|------|
| **问题** | 如何监听 workspace 中的文件变更？ |
| **影响面** | 性能、电池消耗、Git 状态更新 |
| **选项** | <ol><li>**FSEvents (macOS native)** - 系统级文件监听</li><li>**notify-rs** - 跨平台文件监听库</li><li>**轮询** - 定期检查文件状态</li></ol> |
| **建议默认** | **选项 2: notify-rs** - Rust 生态，跨平台潜力 |
| **何时决策** | M1 Git 状态实现阶段 |
| **备注** | 需要处理大量文件的性能问题 |

---

### Q9: 崩溃恢复策略

| 项目 | 内容 |
|------|------|
| **问题** | 应用崩溃后如何恢复状态？ |
| **影响面** | 用户体验、数据安全 |
| **选项** | <ol><li>**不恢复** - 重新打开 workspace</li><li>**恢复 workspace 列表** - 记住打开的 workspace</li><li>**完整恢复** - 恢复终端状态、窗口布局</li></ol> |
| **建议默认** | **选项 2: 恢复 workspace 列表** - 平衡复杂度和体验 |
| **何时决策** | M1 持久化实现阶段 |
| **备注** | 终端状态恢复需要 scrollback 持久化 |

---

### Q10: 国际化 (i18n)

| 项目 | 内容 |
|------|------|
| **问题** | 是否需要支持多语言？ |
| **影响面** | 开发工作量、用户群体 |
| **选项** | <ol><li>**仅英文** - 简化开发</li><li>**英文 + 中文** - 覆盖主要用户群</li><li>**完整 i18n** - 支持多语言扩展</li></ol> |
| **建议默认** | **选项 1: 仅英文** - M0-M2 专注功能 |
| **何时决策** | M2 完成后评估 |
| **备注** | 可以在架构上预留 i18n 支持 |

---

## 问题优先级

| 优先级 | 问题 | 决策时间点 |
|--------|------|-----------|
| P0 | Q1 (WebView 通信) | M0 开始前 |
| P0 | Q2 (Rust Core 启动) | M0 打包阶段 |
| P1 | Q4 (窗口模式) | M1 UI 设计 |
| P1 | Q6 (Setup 环境) | M1 setup 实现 |
| P1 | Q8 (文件监听) | M1 Git 状态 |
| P1 | Q9 (崩溃恢复) | M1 持久化 |
| P2 | Q3 (Scrollback) | M2 功能规划 |
| P2 | Q5 (主题) | M2 功能规划 |
| P2 | Q7 (认证) | M2 远程克隆 |
| P3 | Q10 (i18n) | M2 之后 |
